⁄
jC:\Users\hw72786\Source\Repos\OverWatcher\OverWatcher\OverWatcher.Common.CefSharpBase\CefSharpException.cs
	namespace 	
OverWatcher
 
. 
Common 
. 
CefSharpBase )
{ 
class		 	
CefSharpException		
 
:		 
	Exception		 '
{

 
public 
CefSharpException  
(  !
string! '
msg( +
)+ ,
:- .
base/ 3
(3 4
msg4 7
)7 8
{9 :
}; <
} 
} õ
pC:\Users\hw72786\Source\Repos\OverWatcher\OverWatcher\OverWatcher.Common.CefSharpBase\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str :
): ;
]; <
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str &
)& '
]' (
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str <
)< =
]= >
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 9
)9 :
]: ;
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *Úã
jC:\Users\hw72786\Source\Repos\OverWatcher\OverWatcher\OverWatcher.Common.CefSharpBase\WebControllerBase.cs
	namespace 	
OverWatcher
 
. 
Common 
. 
CefSharpBase )
{ 
public 

class 
WebControllerBase "
{ 
	protected 
volatile 
bool 
isError  '
=( )
false* /
;/ 0
	protected 
volatile 
bool 
isDownloadCompleted  3
=4 5
false6 ;
;; <
	protected 
volatile 
string !
DownloadFileName" 2
=3 4
$str5 7
;7 8
	protected 
AutoResetEvent   
_pageAnalyzeFinished! 5
=6 7
new8 ;
AutoResetEvent< J
(J K
falseK P
)P Q
;Q R
	protected 
readonly 
string !
TempFolderPath" 0
;0 1
	protected 
WebControllerBase #
(# $
string$ *
temp+ /
)/ 0
{ 	
BrowserList 
= 
new 
List "
<" #
ThreadStart# .
>. /
(/ 0
)0 1
;1 2
TempFolderPath 
= 
temp !
;! "
} 	
	protected 
List 
< 
ThreadStart "
>" #
BrowserList$ /
;/ 0
	protected 
string 
_defaultCookiePath +
=, - 
ConfigurationManager. B
.B C
AppSettingsC N
[N O
$strO [
][ \
;\ ]
public   
static   
void   !
InitializeEnvironment   0
(  0 1
)  1 2
{!! 	
if"" 
("" 
!"" 
Cef"" 
."" 
IsInitialized"" "
)""" #
{## 
var$$ 
settings$$ 
=$$ 
new$$ "
CefSettings$$# .
($$. /
)$$/ 0
;$$0 1
settings%% 
.%% #
IgnoreCertificateErrors%% 0
=%%1 2
true%%3 7
;%%7 8
settings&& 
.&& !
BrowserSubprocessPath&& .
=&&/ 0
$str&&1 `
;&&` a
settings'' 
.'' 
LogFile''  
=''! "
$str''# 5
;''5 6
Cef(( 
.(( 

Initialize(( 
((( 
settings(( '
)((' (
;((( )
}** 
}++ 	
public,, 
static,, 
void,, 
CleanupEnvironment,, -
(,,- .
),,. /
{-- 	
Cef.. 
... 
Shutdown.. 
(.. 
).. 
;.. 
}// 	
public11 
void11 
run11 
(11 
)11 
{22 	
BrowserList33 
.33 
Select33 
(33 
b33  
=>33! #
{44 
var55 
thread55 
=55 
new55  
Thread55! '
(55' (
b55( )
)55) *
;55* +
thread66 
.66 
SetApartmentState66 (
(66( )
ApartmentState66) 7
.667 8
STA668 ;
)66; <
;66< =
thread77 
.77 
Start77 
(77 
)77 
;77 
return88 
thread88 
;88 
}99 
)99 
.99 
ToList99 
(99 
)99 
.99 
ForEach99 
(99  
t99  !
=>99" $
t99% &
.99& '
Join99' +
(99+ ,
)99, -
)99- .
;99. /
if:: 
(:: 
isError:: 
):: 
throw:: 
new:: "
CefSharpException::# 4
(::4 5
$str::5 E
)::E F
;::F G
};; 	
	protected== 
CefSharp== 
.== 
Cookie== !
ConvertCookie==" /
(==/ 0
System==0 6
.==6 7
Net==7 :
.==: ;
Cookie==; A
cookie==B H
)==H I
{>> 	
var?? 
c?? 
=?? 
new?? 
CefSharp??  
.??  !
Cookie??! '
(??' (
)??( )
;??) *
c@@ 
.@@ 
Creation@@ 
=@@ 
cookie@@ 
.@@  
	TimeStamp@@  )
;@@) *
cAA 
.AA 
DomainAA 
=AA 
cookieAA 
.AA 
DomainAA $
;AA$ %
cBB 
.BB 
ExpiresBB 
=BB 
cookieBB 
.BB 
ExpiresBB &
;BB& '
cCC 
.CC 
HttpOnlyCC 
=CC 
cookieCC 
.CC  
HttpOnlyCC  (
;CC( )
cDD 
.DD 
NameDD 
=DD 
cookieDD 
.DD 
NameDD  
;DD  !
cEE 
.EE 
PathEE 
=EE 
cookieEE 
.EE 
PathEE  
;EE  !
cFF 
.FF 
SecureFF 
=FF 
cookieFF 
.FF 
SecureFF $
;FF$ %
cGG 
.GG 
ValueGG 
=GG 
cookieGG 
.GG 
ValueGG "
;GG" #
returnHH 
cHH 
;HH 
}II 	
	protectedKK 
HttpWebResponseKK !
MakeHttpRequestKK" 1
(KK1 2
stringKK2 8
urlKK9 <
,KK< =
byteKK> B
[KKB C
]KKC D
encodedPostKKE P
,KKP Q
CookieContainerKKR a
	containerKKb k
)KKk l
{LL 	
HttpWebRequestMM 
requestMM "
=MM# $
HttpWebRequestMM% 3
.MM3 4
CreateMM4 :
(MM: ;
urlMM; >
)MM> ?
asMM@ B
HttpWebRequestMMC Q
;MMQ R
StreamNN 

dataStreamNN 
;NN 
requestPP 
.PP 
MethodPP 
=PP 
$strPP #
;PP# $
requestQQ 
.QQ 
ContentTypeQQ 
=QQ  !
$strQQ" 4
;QQ4 5
ifRR 
(RR 
encodedPostRR 
!=RR 
nullRR #
)RR# $
{SS 
requestTT 
.TT 
ContentLengthTT %
=TT& '
encodedPostTT( 3
.TT3 4
LengthTT4 :
;TT: ;

dataStreamUU 
=UU 
requestUU $
.UU$ %
GetRequestStreamUU% 5
(UU5 6
)UU6 7
;UU7 8

dataStreamVV 
.VV 
WriteVV  
(VV  !
encodedPostVV! ,
,VV, -
$numVV. /
,VV/ 0
encodedPostVV1 <
.VV< =
LengthVV= C
)VVC D
;VVD E

dataStreamWW 
.WW 
CloseWW  
(WW  !
)WW! "
;WW" #
}XX 
ifZZ 
(ZZ 
	containerZZ 
!=ZZ 
nullZZ !
)ZZ! "
{[[ 
request\\ 
.\\ 
CookieContainer\\ '
=\\( )
	container\\* 3
;\\3 4
}]] 
HttpWebResponse__ 
response__ $
=__% &
request__' .
.__. /
GetResponse__/ :
(__: ;
)__; <
as__= ?
HttpWebResponse__@ O
;__O P
return`` 
response`` 
;`` 
}aa 	
	protectedcc 
stringcc 
GetResponseStringcc *
(cc* +
HttpWebResponsecc+ :
responsecc; C
)ccC D
{dd 	
varee 

dataStreamee 
=ee 
responseee %
.ee% &
GetResponseStreamee& 7
(ee7 8
)ee8 9
;ee9 :
StreamReaderff 
readerff 
=ff  !
newff" %
StreamReaderff& 2
(ff2 3

dataStreamff3 =
)ff= >
;ff> ?
stringgg 
responseStringgg !
=gg" #
readergg$ *
.gg* +
	ReadToEndgg+ 4
(gg4 5
)gg5 6
;gg6 7

dataStreamhh 
.hh 
Closehh 
(hh 
)hh 
;hh 
responseii 
.ii 
Closeii 
(ii 
)ii 
;ii 
returnjj 
responseStringjj !
;jj! "
}kk 	
	protectedmm 
stringmm 
GetCookieHeadermm (
(mm( )
HttpWebResponsemm) 8
responsemm9 A
)mmA B
{nn 	
returnoo 
responseoo 
.oo 
Headersoo #
.oo# $
Getoo$ '
(oo' (
$stroo( 4
)oo4 5
;oo5 6
;oo7 8
}pp 	
	protectedrr 
asyncrr 
Taskrr 
<rr 
boolrr !
>rr! "
IsPageLoadingrr# 0
(rr0 1
ChromiumWebBrowserrr1 C
wbrrD F
,rrF G(
LoadingStateChangedEventArgsrrH d
erre f
)rrf g
{ss 	
iftt 
(tt 
ett 
.tt 
	IsLoadingtt 
)tt 
returntt #
truett$ (
;tt( )
varuu 
htmluu 
=uu 
awaituu 
wbuu 
.uu  
GetSourceAsyncuu  .
(uu. /
)uu/ 0
;uu0 1
ifvv 
(vv 
htmlvv 
==vv 
$strvv A
)vvA B
returnvvC I
truevvJ N
;vvN O
returnww 
falseww 
;ww 
}xx 	
	protectedyy 
voidyy 
WriteCookiesToDiskyy )
(yy) *
stringyy* 0
fileyy1 5
,yy5 6
stringyy7 =
	cookieJaryy> G
)yyG H
{zz 	
if{{ 
({{ 
String{{ 
.{{ 
IsNullOrEmpty{{ $
({{$ %
file{{% )
){{) *
){{* +
file{{, 0
={{1 2
_defaultCookiePath{{3 E
;{{E F
try|| 
{}} 
Logger~~ 
.~~ 
Info~~ 
(~~ 
$str~~ 9
)~~9 :
;~~: ;
if 
( 
! 
File 
. 
Exists  
(  !
file! %
)% &
)& '
{
ÄÄ 
File
ÅÅ 
.
ÅÅ 
WriteAllText
ÅÅ %
(
ÅÅ% &
file
ÅÅ& *
,
ÅÅ* +
	cookieJar
ÅÅ, 5
)
ÅÅ5 6
;
ÅÅ6 7
}
ÇÇ 
Logger
ÉÉ 
.
ÉÉ 
Info
ÉÉ 
(
ÉÉ 
$str
ÉÉ #
)
ÉÉ# $
;
ÉÉ$ %
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ 
e
ÖÖ 
)
ÖÖ 
{
ÜÜ 
Logger
áá 
.
áá 
Warn
áá 
(
áá 
$str
áá ?
+
áá@ A
e
ááB C
.
ááC D
GetType
ááD K
(
ááK L
)
ááL M
)
ááM N
;
ááN O
}
àà 
}
ââ 	
	protected
ãã 
string
ãã !
ReadCookiesFromDisk
ãã ,
(
ãã, -
string
ãã- 3
file
ãã4 8
)
ãã8 9
{
åå 	
if
çç 
(
çç 
String
çç 
.
çç 
IsNullOrEmpty
çç $
(
çç$ %
file
çç% )
)
çç) *
)
çç* +
file
çç, 0
=
çç1 2 
_defaultCookiePath
çç3 E
;
ççE F
if
éé 
(
éé 
!
éé 
File
éé 
.
éé 
Exists
éé 
(
éé 
file
éé !
)
éé! "
)
éé" #
{
èè 
Logger
êê 
.
êê 
Info
êê 
(
êê 
$str
êê D
)
êêD E
;
êêE F
return
ëë 
null
ëë 
;
ëë 
}
íí 
try
ìì 
{
îî 
return
ïï 
System
ïï 
.
ïï 
IO
ïï  
.
ïï  !
File
ïï! %
.
ïï% &
ReadAllLines
ïï& 2
(
ïï2 3
file
ïï3 7
)
ïï7 8
[
ïï8 9
$num
ïï9 :
]
ïï: ;
;
ïï; <
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
ex
óó 
)
óó  
{
òò 
Logger
ôô 
.
ôô 
Error
ôô 
(
ôô 
ex
ôô 
,
ôô  
$str
ôô! F
)
ôôF G
;
ôôG H
return
öö 
null
öö 
;
öö 
}
õõ 
}
úú 	
	protected
ûû 
async
ûû 
Task
ûû 
<
ûû 
object
ûû #
>
ûû# $ 
SavePageScreenShot
ûû% 7
(
ûû7 8 
ChromiumWebBrowser
ûû8 J
wb
ûûK M
,
ûûM N
string
ûûO U
path
ûûV Z
)
ûûZ [
{
üü 	
var
†† 
task
†† 
=
†† 
await
†† 
wb
†† 
.
††  
ScreenshotAsync
††  /
(
††/ 0
)
††0 1
;
††1 2
string
°° 
path1
°° 
=
°° 
Environment
°° &
.
°°& '
GetFolderPath
°°' 4
(
°°4 5
Environment
°°5 @
.
°°@ A
SpecialFolder
°°A N
.
°°N O
Desktop
°°O V
)
°°V W
+
°°X Y
$str
°°Z c
;
°°c d
Logger
¢¢ 
.
¢¢ 
Info
¢¢ 
(
¢¢ 
string
¢¢ 
.
¢¢ 
Format
¢¢ %
(
¢¢% &
$str
¢¢& G
,
¢¢G H
path1
¢¢I N
)
¢¢N O
)
¢¢O P
;
¢¢P Q
task
¶¶ 
.
¶¶ 
Save
¶¶ 
(
¶¶ 
path1
¶¶ 
)
¶¶ 
;
¶¶ 
task
™™ 
.
™™ 
Dispose
™™ 
(
™™ 
)
™™ 
;
™™ 
return
∞∞ 
Task
∞∞ 
.
∞∞ 

FromResult
∞∞ "
<
∞∞" #
object
∞∞# )
>
∞∞) *
(
∞∞* +
null
∞∞+ /
)
∞∞/ 0
;
∞∞0 1
}
±± 	
	protected
≥≥ 
Task
≥≥ 
<
≥≥  
JavascriptResponse
≥≥ )
>
≥≥) *&
EvaluateXPathScriptAsync
≥≥+ C
(
≥≥C D 
ChromiumWebBrowser
≥≥D V
wb
≥≥W Y
,
≥≥Y Z
string
≥≥[ a
xpath
≥≥b g
,
≥≥g h
string
≥≥i o
action
≥≥p v
)
≥≥v w
{
¥¥ 	
return
µµ 
wb
µµ 
.
µµ !
EvaluateScriptAsync
µµ )
(
µµ) *
string
∂∂ 
.
∂∂ 
Format
∂∂ 
(
∂∂ 
$str
∂∂ x
,
∂∂x y
xpath
∂∂z 
,∂∂ Ä
action∂∂Å á
)∂∂á à
)∂∂à â
;∂∂â ä
}
∑∑ 	
	protected
ππ 
class
ππ 
DownloadHandler
ππ '
:
ππ( )
IDownloadHandler
ππ* :
{
∫∫ 	
WebControllerBase
ªª 
drm
ªª !
;
ªª! "
void
ºº 
IDownloadHandler
ºº !
.
ºº! "
OnBeforeDownload
ºº" 2
(
ºº2 3
IBrowser
ºº3 ;
browser
ºº< C
,
ººC D
DownloadItem
ººE Q
downloadItem
ººR ^
,
ºº^ _%
IBeforeDownloadCallback
ºº` w
callbackººx Ä
)ººÄ Å
{
ΩΩ 
if
ææ 
(
ææ 
!
ææ 
callback
ææ 
.
ææ 

IsDisposed
ææ (
)
ææ( )
{
øø 
using
¿¿ 
(
¿¿ 
callback
¿¿ #
)
¿¿# $
{
¡¡ 
drm
¬¬ 
.
¬¬ 
DownloadFileName
¬¬ ,
=
¬¬- .
downloadItem
¬¬/ ;
.
¬¬; <
SuggestedFileName
¬¬< M
;
¬¬M N
callback
√√  
.
√√  !
Continue
√√! )
(
√√) *"
ConfigurationManager
√√* >
.
√√> ?
AppSettings
√√? J
[
√√J K
$str
√√K [
]
√√[ \
+
√√] ^
downloadItem
ƒƒ, 8
.
ƒƒ8 9
SuggestedFileName
ƒƒ9 J
,
ƒƒJ K

showDialog
ƒƒL V
:
ƒƒV W
false
ƒƒX ]
)
ƒƒ] ^
;
ƒƒ^ _
}
≈≈ 
}
∆∆ 
}
«« 
void
…… 
IDownloadHandler
…… !
.
……! "
OnDownloadUpdated
……" 3
(
……3 4
IBrowser
……4 <
browser
……= D
,
……D E
DownloadItem
……F R
downloadItem
……S _
,
……_ `#
IDownloadItemCallback
……a v
callback
……w 
)…… Ä
{
   
if
ÀÀ 
(
ÀÀ 
downloadItem
ÀÀ  
.
ÀÀ  !

IsComplete
ÀÀ! +
)
ÀÀ+ ,
{
ÃÃ 
drm
ÕÕ 
.
ÕÕ !
isDownloadCompleted
ÕÕ +
=
ÕÕ, -
true
ÕÕ. 2
;
ÕÕ2 3
}
ŒŒ 
}
œœ 
public
—— 
DownloadHandler
—— "
(
——" #
WebControllerBase
——# 4
drm
——5 8
)
——8 9
{
““ 
this
”” 
.
”” 
drm
”” 
=
”” 
drm
”” 
;
”” 
}
‘‘ 
}
’’ 	
}
÷÷ 
}◊◊ 